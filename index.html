<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Calculateur d'apport calcique quotidien pour suivre sa consommation de calcium par repas">
  <meta name="theme-color" content="#4CAF50">
  <title>Calculateur Calcium Repas</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f0f0f0; }
    input[type=number] { width: 60px; }
    .total { font-weight: bold; background-color: #e0ffe0; }
    .totaux-journaliers { font-size: 1.1em; margin: 10px 0; font-weight: bold; }
    .meal-summary { 
      background-color: #f9f9f9; 
      font-size: 0.9em; 
      max-height: 100px; 
      overflow-y: auto; 
      padding: 5px;
      min-height: 60px;
    }
    .meal-summary ul {
      margin: 0;
      padding-left: 15px;
      list-style-type: circle;
    }
    .meal-summary li {
      margin-bottom: 3px;
    }
    
    /* Responsive styles */
    @media (max-width: 768px) {
      table { display: block; overflow-x: auto; }
      input[type=number] { width: 40px; }
      .meal-summary { font-size: 0.8em; }
    }
  </style>
</head>
<body>
  <h1>Calculateur d'apport calcique quotidien</h1>
  <p>S√©lectionnez les quantit√©s de chaque aliment consomm√© √† chaque repas.</p>

  <div class="totaux-journaliers">Total journalier estim√© : <span id="total-daily">0</span> mg</div>

  <table>
    <thead>
      <tr>
        <th>Aliment</th>
        <th>Portion type</th>
        <th>Calcium / portion</th>
        <th>Petit-d√©j</th>
        <th>D√©jeuner</th>
        <th>Go√ªter</th>
        <th>D√Æner</th>
      </tr>
    </thead>
    <tbody id="table-body">
      <tr id="meal-summaries-row">
        <td colspan="3"><strong>Aliments s√©lectionn√©s</strong></td>
        <td id="breakfast-summary" class="meal-summary"><ul></ul></td>
        <td id="lunch-summary" class="meal-summary"><ul></ul></td>
        <td id="snack-summary" class="meal-summary"><ul></ul></td>
        <td id="dinner-summary" class="meal-summary"><ul></ul></td>
      </tr>
    </tbody>
    <tfoot>
      <tr class="total">
        <td colspan="3">Total Calcium (mg)</td>
        <td id="total-breakfast">0</td>
        <td id="total-lunch">0</td>
        <td id="total-snack">0</td>
        <td id="total-dinner">0</td>
      </tr>
    </tfoot>
  </table>

  <div class="totaux-journaliers">Total journalier estim√© : <span id="total-daily-bottom">0</span> mg</div>
  
  <div style="margin: 20px 0; display: flex; gap: 10px;">
    <button onclick="saveData()" style="padding: 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">üíæ Sauvegarder mes quantit√©s</button>
    <button onclick="exportData()" style="padding: 10px; background-color: #008CBA; color: white; border: none; border-radius: 4px; cursor: pointer;">üì§ Exporter mes donn√©es</button>
  </div>

  <script>
    // Function to export data as CSV
    function exportData() {
      // Create CSV header
      let csv = 'Aliment,Portion,Calcium par portion,Petit-d√©jeuner,D√©jeuner,Go√ªter,D√Æner\n';
      
      // Add each food item to CSV
      foods.forEach((food, i) => {
        let values = [
          food.name,
          food.portion,
          food.calcium
        ];
        
        // Add quantities for each meal
        meals.forEach(meal => {
          const input = document.getElementById(`${meal}-${i}`);
          values.push(input.value || '0');
        });
        
        // Add line to CSV
        csv += values.join(',') + '\n';
      });
      
      // Create downloadable link
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', 'calciplan_export.csv');
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  
  </script>
  
  <script>
    const foods = [
      { name: "Yaourt nature", portion: "1 pot (125 g)", calcium: 150 },
      { name: "Kiri", portion: "1 portion (20 g)", calcium: 130 },
      { name: "Fromage blanc", portion: "100 g", calcium: 120 },
      { name: "Amandes", portion: "15 g (petite poign√©e)", calcium: 100 },
      { name: "Hepar / Contrex", portion: "250 ml", calcium: 125 },
      { name: "Sardines sans ar√™tes", portion: "100 g", calcium: 40 },
      { name: "Tofu enrichi", portion: "100 g", calcium: 250 },
      { name: "Chou cuit", portion: "150 g", calcium: 100 },
      { name: "Brocoli", portion: "150 g", calcium: 100 },
      { name: "Lait", portion: "250 ml", calcium: 300 },
      { name: "≈íuf", portion: "1 ≈ìuf", calcium: 25 },
      { name: "Graines tournesol/courge", portion: "15 g", calcium: 50 },
      { name: "Pain complet", portion: "50 g", calcium: 20 },
      { name: "Myrtilles", portion: "50 g", calcium: 5 },
      { name: "Pruneaux", portion: "3 unit√©s", calcium: 10 },
      { name: "Oignons cuits", portion: "100 g", calcium: 10 },
      { name: "Tomates", portion: "100 g", calcium: 15 },
      { name: "Poisson blanc", portion: "100 g", calcium: 15 },
      { name: "Poulet", portion: "100 g", calcium: 15 }
    ];

    const meals = ["breakfast", "lunch", "snack", "dinner"];

    function updateMealSummary(meal) {
      const summaryElement = document.getElementById(`${meal}-summary`).querySelector('ul');
      summaryElement.innerHTML = ''; // Clear existing items
      
      let hasItems = false;
      foods.forEach((food, i) => {
        const input = document.getElementById(`${meal}-${i}`);
        const quantity = parseFloat(input.value) || 0;
        
        if (quantity > 0) {
          hasItems = true;
          const calciumAmount = quantity * food.calcium;
          const li = document.createElement('li');
          li.textContent = `${quantity} √ó ${food.name} (${calciumAmount} mg)`;
          summaryElement.appendChild(li);
        }
      });
      
      // Show a message if no items selected
      if (!hasItems) {
        const li = document.createElement('li');
        li.textContent = 'Aucun aliment s√©lectionn√©';
        li.style.fontStyle = 'italic';
        li.style.color = '#777';
        summaryElement.appendChild(li);
      }
    }
    
    function updateTotals() {
      let dailyTotal = 0;
      meals.forEach(meal => {
        let total = 0;
        foods.forEach((_, i) => {
          const input = document.getElementById(`${meal}-${i}`);
          const val = parseFloat(input.value) || 0;
          total += val * foods[i].calcium;
        });
        document.getElementById(`total-${meal}`).textContent = total;
        dailyTotal += total;
        
        // Update the meal summary
        updateMealSummary(meal);
      });
      document.getElementById("total-daily").textContent = dailyTotal;
      document.getElementById("total-daily-bottom").textContent = dailyTotal;
    }

    function saveData() {
      const data = {};
      meals.forEach(meal => {
        data[meal] = foods.map((_, i) => parseFloat(document.getElementById(`${meal}-${i}`).value) || 0);
      });
      localStorage.setItem("calciumIntake", JSON.stringify(data));
      alert("Quantit√©s sauvegard√©es dans le navigateur.");
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem("calciumIntake"));
      if (!data) return;
      meals.forEach(meal => {
        foods.forEach((_, i) => {
          const input = document.getElementById(`${meal}-${i}`);
          if (data[meal] && data[meal][i] != null) {
            input.value = data[meal][i];
          }
        });
      });
      updateTotals();
    }

    // Create food rows
    const tbody = document.getElementById("table-body");
    const mealSummaryRow = document.getElementById("meal-summaries-row");
    
    foods.forEach((food, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${food.name}</td>
        <td>${food.portion}</td>
        <td>${food.calcium} mg</td>
        ${meals.map(meal => `<td><input type="number" id="${meal}-${i}" min="0" value="0" onchange="updateTotals()"></td>`).join("")}
      `;
      tbody.appendChild(tr);
    });

    // Initialize page
    window.onload = function() {
      loadData();
      // Initialize meal summaries
      meals.forEach(meal => updateMealSummary(meal));
    };
  </script>
</body>
</html>